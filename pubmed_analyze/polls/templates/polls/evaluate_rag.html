{% extends "polls/base.html" %}

{% block title %}Evaluer un RAG{% endblock %}

{% block content %}
<h1 class="mt-4">Evaluer un RAG</h1>
<div class="mt-4"></div>
<form method="post">
    {% csrf_token %}

    <!-- Research Type -->
    <div class="form-group">
        {{ form.research_type.label_tag }}
        {{ form.research_type }}
    </div>
    
    <!-- Model Selection -->
    <div class="form-group field-group" id="model_group">
        {{ form.model.label_tag }}
        {{ form.model }}
    </div>
    
    <!-- Sliders with Current Values -->
    <div class="form-group field-group" id="number_of_results_group">
        {{ form.number_of_results.label_tag }}
        <input type="range" id="id_number_of_results" name="number_of_results" min="0" max="100" value="{{ form.number_of_results.value|default:0 }}" oninput="updateSliderValue('number_of_results_value', this.value)">
        <span id="number_of_results_value">{{ form.number_of_results.value|default:0 }}</span>
    </div>
    
    <div class="form-group field-group" id="number_of_articles_group">
        {{ form.number_of_articles.label_tag }}
        <input type="range" id="id_number_of_articles" name="number_of_articles" min="0" max="50" value="{{ form.number_of_articles.value|default:0 }}" oninput="updateSliderValue('number_of_articles_value', this.value)">
        <span id="number_of_articles_value">{{ form.number_of_articles.value|default:0 }}</span>
    </div>
    
    <div class="form-group field-group" id="title_weight_group">
        {{ form.title_weight.label_tag }}
        <input type="range" id="id_title_weight" name="title_weight" min="0" max="1" step="0.01" value="{{ form.title_weight.value|default:0 }}" oninput="updateSliderValue('title_weight_value', this.value)">
        <span id="title_weight_value">{{ form.title_weight.value|default:0 }}</span>
    </div>
    
    <div class="form-group field-group" id="abstract_weight_group">
        {{ form.abstract_weight.label_tag }}
        <input type="range" id="id_abstract_weight" name="abstract_weight" min="0" max="1" step="0.01" value="{{ form.abstract_weight.value|default:0 }}" oninput="updateSliderValue('abstract_weight_value', this.value)">
        <span id="abstract_weight_value">{{ form.abstract_weight.value|default:0 }}</span>
    </div>
    
    <div class="form-group field-group" id="rank_scaling_factors_group">
        {{ form.rank_scaling_factors.label_tag }}
        <input type="range" id="id_rank_scaling_factors" name="rank_scaling_factors" min="0" max="5" step="0.1" value="{{ form.rank_scaling_factors.value|default:0 }}" oninput="updateSliderValue('rank_scaling_factors_value', this.value)">
        <span id="rank_scaling_factors_value">{{ form.rank_scaling_factors.value|default:0 }}</span>
    </div>

    <button type="submit" class="btn btn-primary">Lancer l'Ã©valuation</button>
</form>

<!-- JavaScript for Real-Time Slider Value Updates and Field Visibility -->
<script>
    function updateSliderValue(spanId, value) {
        document.getElementById(spanId).textContent = value;
    }

    document.addEventListener('DOMContentLoaded', function () {
        const sliders = document.querySelectorAll('input[type="range"]');
        sliders.forEach(slider => {
            slider.dispatchEvent(new Event('input')); // Initialize display on page load
        });
        
        const researchTypeSelect = document.getElementById('id_research_type');
        const modelGroup = document.getElementById('model_group');
        const numberOfResultsGroup = document.getElementById('number_of_results_group');
        const numberOfArticlesGroup = document.getElementById('number_of_articles_group');
        const titleWeightGroup = document.getElementById('title_weight_group');
        const abstractWeightGroup = document.getElementById('abstract_weight_group');
        const rankScalingFactorsGroup = document.getElementById('rank_scaling_factors_group');

        function toggleFields() {
            const selectedType = researchTypeSelect.value;
            // Hide all fields initially
            modelGroup.style.display = "none";
            numberOfResultsGroup.style.display = "none";
            numberOfArticlesGroup.style.display = "none";
            titleWeightGroup.style.display = "none";
            abstractWeightGroup.style.display = "none";
            rankScalingFactorsGroup.style.display = "none";
            // Show relevant fields based on selected research type
            if (selectedType === 'neural') {
                modelGroup.style.display = "block";
                numberOfResultsGroup.style.display = "block";
                numberOfArticlesGroup.style.display = "block";
            } else if (selectedType === 'text') {
                titleWeightGroup.style.display = "block";
                abstractWeightGroup.style.display = "block";
                numberOfResultsGroup.style.display = "block";
            } else if (selectedType === 'hybrid') {
                modelGroup.style.display = "block";
                numberOfResultsGroup.style.display = "block";
                numberOfArticlesGroup.style.display = "block";
                titleWeightGroup.style.display = "block";
                abstractWeightGroup.style.display = "block";
                rankScalingFactorsGroup.style.display = "block";
            }
        }

        // Event listener for research type selection
        researchTypeSelect.addEventListener('change', toggleFields);
        toggleFields(); // Initialize field visibility on page load
    });
</script>

{% endblock %}
